<!DOCTYPE html>
<html>
<head>
    <title>Project 4A</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
    </style>
    <style>
        table {
            width: 80%;
            border-collapse: collapse;
            margin: 20px auto;
        }
        td {
            text-align: center;
            padding: 10px;
        }
        img {
            width: 100%;
            height: auto;
        }
        caption {
            font-size: 1.2em;
            font-weight: bold;
            padding: 10px;
        }
        .caption {
            font-weight: bold;
            font-size: 1em;
            padding-top: 5px;
        }
    </style>
</head>
<body>
    <div class="navbar clear nav-top">
        <div class="row" style="text-align: center;">
            <h1> Project 3: Face Morphing </h1>
        </div>
    </div>

    <h2> Background </h2>
    <p> 
        A “cool” application of different aspects of image warping is image mosaicing. Using two or more photographs, you can create an image mosaic by registering, projective warping, resampling, and compositing them. One significant method used in the project was the computation of homographies, which was used to warp images.
    </p>

    <h2> Shoot the Pictures </h2>
    <h3> Approach </h3>
    <p>
        I took photos at multiple locations by rotating my iPhone camera on a flat surface.
    </p>
    <h3> Example Images </h3>
    <table border="1">
        <tr>
            <td>
                <img src="media/woz1.jpg" style="width:300px;height:auto;" alt="woz1.jpg">
                <div class="caption"> Woz Left </div>
            </td>
            <td>
                <img src="media/woz2.jpg" style="width:300px;height:auto;" alt="woz2.jpg">
                <div class="caption"> Woz Right </div>
            </td>
        </tr>
        <tr>
            <td>
                <img src="media/enclave1.jpg" style="width:300px;height:auto;" alt="enclave1.jpg">
                <div class="caption"> Enclave Left </div>
            </td>
            <td>
                <img src="media/enclave2.jpg" style="width:300px;height:auto;" alt="enclave2.jpg">
                <div class="caption"> Enclave Right </div>
            </td>
        </tr>
        <tr>
            <td>
                <img src="media/hmmb1.jpg" style="width:300px;height:auto;" alt="hmmb1.jpg">
                <div class="caption"> Hearst Memorial Mining Building (HMMB) Left </div>
            </td>
            <td>
                <img src="media/hmmb2.jpg" style="width:300px;height:auto;" alt="hmmb2.jpg">
                <div class="caption"> HMMB Right </div>
            </td>
        </tr>
        <tr>
            <td>
                <img src="media/apt1.jpg" style="width:300px;height:auto;" alt="apt1.jpg">
                <div class="caption"> Apartment Left </div>
            </td>
            <td>
                <img src="media/apt2.jpg" style="width:300px;height:auto;" alt="apt2.jpg">
                <div class="caption"> Apartment Left </div>
            </td>
        </tr>
    </table>

    <h2> Recover Homographies </h2>
    <h3> Approach </h3>
    <p>
        First, I wrote an affine transformation function, <code>affine_transform</code> using the affine transformation formula from the class lecture slides, <code>[x' y' 1] = [x y 1] * A^T</code> (where <code>A</code> is a matrix). Next, I inverse warped the Delaunay triangulations of the midway image and <code>alan.jpg</code> the previous part. This was done by first using a for-loop that iterates through the correlating triangles in the triangulations and finding its affine transform. Next, I used <code>scipy.draw.polygon</code> to find all points within the midway triangle, and applied the inverse warping formula <code>A^-1 * [x' y' 1] = [x y 1]</code> to each point. I rounded each point to the nearest integer, used those points from the source image to set the points in the midway triangle to get the final warped image. I used this approach to warp <code>alan.jpg</code> and <code>jacob.jpg</code> with the midway triangulation. Finally, in order to find the midway image, I cross-dissolved by averaging the images.
    </p>

    <h2> Warp the Images </h2>
    <h3> Approach </h3>
    <p>
        Modifying my code from the previous part, I wrote a <code>morph</code> function that uses <code>warp_frac</code> to control the intermediate shape configuration and <code>dissolve_frac</code> to cross-dissolve. I morphed the faces over 45 times while incrementing the <code>warp_frac</code> and <code>dissolve_frac</code> parameters from <code>0</code> to <code>1</code>. Finally, I took the resulting images and merged them into a GIF using an online GIF creator.
    </p>

    <h2> Image Rectification </h2>
    <h3> Approach </h3>
    <p>
        I used the non-smiling/mug faces from the <a href="https://fei.edu.br/~cet/facedatabase.html">FEI Face Database</a> for this part. I parsed the <code>.pts</code> files with a helper function using <code>np.loadtxt</code> to get the corresponding points of every image. I then averaged all of the corresponding points and found its triangulation to get the average points and triangulation of the population. I used my <code>morph</code> function to morph every face with the average face shape of the population (some examples showed below). I then cross dissolved all of these morphs to create the average face of the population. Finally, I morphed my face into the average face shape of the population, and vice versa. 
    </p>
    <h3> Example Image Rectifications </h3>
    <table border="1">
        <tr>
            <td>
                <img src="media/woz1.jpg" style="width:300px;height:auto;" alt="woz1.jpg">
                <div class="caption"> Woz Left </div>
            </td>
            <td>
                <img src="media/woz2.jpg" style="width:300px;height:auto;" alt="woz2.jpg">
                <div class="caption"> Woz Right </div>
            </td>
        </tr>
        <tr>
            <td>
                <img src="media/woz1.jpg" style="width:300px;height:auto;" alt="woz1.jpg">
                <div class="caption"> Woz Left </div>
            </td>
            <td>
                <img src="media/woz2.jpg" style="width:300px;height:auto;" alt="woz2.jpg">
                <div class="caption"> Woz Right </div>
            </td>
        </tr>
    </table>

    <h2> Blend the images into a mosaic </h2>
    <h3> Approach </h3>
    <p>
        I used the formula <code>alpha * mean_image + (1 - alpha) * self_image</code> to extrapolate from the population mean to create a caricature of myself. I used <code>alpha = 2</code> for this part. Note that this formula is analogous to the warp weighing formula involving <code>warp_frac</code> in my <code>morph</code> function. Thus, I called <code>morph</code> with <code>warp_frac=2</code> and <code>dissolve_frac=0</code> to generate my caricature.
    </p>
  
    <h3> Example Destination Transform and Mask </h3>
    <table border="1">
        <tr>
            <td>
                <img src="media/woz1.jpg" style="width:300px;height:auto;" alt="woz1.jpg">
                <div class="caption"> Enclave Left Destination Transform </div>
            </td>
            <td>
                <img src="media/woz2.jpg" style="width:300px;height:auto;" alt="woz2.jpg">
                <div class="caption"> Enclave Right Destination Transform </div>
            </td>
            <td>
                <img src="media/woz1.jpg" style="width:300px;height:auto;" alt="woz1.jpg">
                <div class="caption"> Enclave Mask </div>
            </td>
        </tr>
    </table>

    <h3> Mosaics </h3>
    <img src="media/woz1.jpg" alt="woz1.jpg">
    <div class="caption"> Woz Mosaic </div>

    <img src="media/woz1.jpg" alt="woz1.jpg">
    <div class="caption"> Woz Mosaic </div>

    <img src="media/woz1.jpg" alt="woz1.jpg">
    <div class="caption"> Woz Mosaic </div>

    <img src="media/woz1.jpg" alt="woz1.jpg">
    <div class="caption"> Woz Mosaic </div>
</body>
</html>
