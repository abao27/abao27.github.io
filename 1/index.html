<!DOCTYPE html>
<html>
<head>
    <title>Project 1</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div class="navbar clear nav-top">
        <div class="row" style="text-align: center;">
            <h1>Project 1: Colorizing the Prokudin-Gorskii photo collection</h1>
        </div>
    </div>
    <div class="container clear">
        <div class="row wrapper">
            <!-- Table of Contents -->
            <div class="sidepanel" id="table-of-contents"></div>

            <!-- Contents -->
            <div class="right-col">
                <div class="gallery" style="text-align: center;">
                    <img src="results/emir.jpg" />
                </div>



                <h1 id="introduction">Introduction</h1>
                <p>
                    Text
                </p>



                <div class="section-divider"></div>



                <h1 id="single-scale-alignment">Single-scale Alignment</h1>

                <h2 id="single-scale-alignment-approach">Approach</h2>
                <p>
                    Text
                </p>
                <p>
                    Text
                </p>

                <h2 id="single-scale-alignment-results">Results</h2>
                <div class="gallery">
                    <img src="media/cathedral.png" />
                    <img src="media/monastery.png" />
                    <img src="media/tobolsk.png" />
                </div>

                <h2 id="single-scale-alignment-custom-images">Custom Images</h2>
                <div class="gallery">
                    <img src="results/x_conservatory.jpg" />
                    <img src="results/x_peonies.jpg" />
                </div>

                <h2 id="single-scale-alignment-offsets">Offsets</h2>
                <table id="single-scale-alignment-offsets-list" class="comparison">
                    <tr>
                        <th>File name</th>
                        <th>Red dx</th>
                        <th>Red dy</th>
                        <th>Green dx</th>
                        <th>Green dy</th>
                    </tr>
                </table>
                <script>
                    const list = document.getElementById('single-scale-alignment-offsets-list')
                    for (let name of Object.keys(offsets).sort().reverse()) {
                        if (!name.endsWith('jpg')) continue
                        const data = offsets[name]
                        const tr = document.createElement('tr')
                        tr.innerHTML = `
                            <td>${name}</td>
                            <td>${data.r_dx}</td>
                            <td>${data.r_dy}</td>
                            <td>${data.g_dx}</td>
                            <td>${data.g_dy}</td>
                        `
                        list.appendChild(tr)
                    }
                </script>


                <div class="section-divider"></div>



                <h1 id="multi-scale-alignment">Multi-scale Alignment</h1>

                <h2 id="multi-scale-alignment-approach">Approach</h2>
                <p>
                    <code>text</code>
                </p>

                <h2 id="multi-scale-alignment-optimizations">Optimizations</h2>
                <p>
                    text
                </p>
                <p>
                    text
                </p>

                <h2 id="multi-scale-alignment-results">Results</h2>
                <div class="gallery">
                    <img src="results/church.jpg" />
                    <img src="results/emir.jpg" />
                    <img src="results/harvesters.jpg" />
                    <img src="results/icon.jpg" />
                    <img src="results/lady.jpg" />
                    <img src="results/melons.jpg" />
                    <img src="results/onion_church.jpg" />
                    <img src="results/sculpture.jpg" />
                    <img src="results/self_portrait.jpg" />
                    <img src="results/three_generations.jpg" />
                    <img src="results/train.jpg" />
                </div>

                <h2 id="multi-scale-alignment-misalignments">Misalignments</h2>
                <p>
                    Text
                </p>
                <img src="extras\lady_fixed.jpg" width="100%" style="max-width: 750px;" />

                <h2 id="multi-scale-alignment-custom-images">Custom Images</h2>
                <div class="gallery">
                    <img src="results/x_bird_cherry_tree.jpg" />
                    <img src="results/x_in_little_russia.jpg" />
                    <img src="results/x_lilacs.jpg" />
                    <img src="results/x_sunset_at_the_sea.jpg" />
                    <img src="results/x_sunset.jpg" />
                    <img src="results/x_urals.jpg" />
                </div>

                <h2 id="multi-scale-alignment-offsets">Offsets</h2>
                <table id="multi-scale-alignment-offsets-list" class="comparison">
                    <tr>
                        <th>File name</th>
                        <th>Red dx</th>
                        <th>Red dy</th>
                        <th>Green dx</th>
                        <th>Green dy</th>
                    </tr>
                </table>
                <script>
                    const list2 = document.getElementById('multi-scale-alignment-offsets-list')
                    for (let name of Object.keys(offsets).sort().reverse()) {
                        if (!name.endsWith('tif')) continue
                        const data = offsets[name]
                        const tr = document.createElement('tr')
                        tr.innerHTML = `
                            <td>${name}</td>
                            <td>${data.r_dx}</td>
                            <td>${data.r_dy}</td>
                            <td>${data.g_dx}</td>
                            <td>${data.g_dy}</td>
                        `
                        list2.appendChild(tr)
                    }
                </script>

                <div class="section-divider"></div>



                <h1 id="bells-and-whistles">Bells and Whistles</h1>

                <h2 id="bells-and-whistles-contrast">Contrast</h2>
                <p>
                    Automatic contrasting was implemented using the cumulative histogram method
                    taught in class. For each channel, an array <code>freq</code> of size
                    <code>256</code> was used to count the frequency of each pixel intensity value.
                    A prefix sum is computed over the values in this array such that
                    <code>prefix[i] = sum(freq[:i+1])</code>. The last element of the prefix sum is
                    the total number of pixels in the image, which is stored as <code>total</code>.
                    This way, <code>prefix[i] / total</code> gives the proportion of pixels that
                    have intensity <code><= i</code>. For each pixel in the channel, its intensity
                    is reassigned to be equal to <code>prefix[i] / total * 255</code>, which
                    stretches the dynamic range of the channel to fill <code>[0, 255]</code>.
                </p>
                <table class="comparison">
                    <tr>
                        <th>Before</th>
                        <th>After</th>
                    </tr>
                    <tr>
                        <td><img src="results/cathedral.jpg" /></td>
                        <td><img src="extras/contrast/cathedral.jpg" /></td>
                    </tr>
                    <tr>
                        <td><img src="results/monastery.jpg" /></td>
                        <td><img src="extras/contrast/monastery.jpg" /></td>
                    </tr>
                    <tr>
                        <td><img src="results/tobolsk.jpg" /></td>
                        <td><img src="extras/contrast/tobolsk.jpg" /></td>
                    </tr>
                    <tr>
                        <td><img src="results/church.jpg" /></td>
                        <td><img src="extras/contrast/church.jpg" /></td>
                    </tr>
                </table>

                <h2 id="bells-and-whistles-white-balance">White Balance</h2>
                <p>
                    White balancing was achieved through shifting the average pixel color to a desired <code>gray_point</code>. The average color vector <code>avg_color</code> was computed using <code>np.mean()</code> across the first (<code>y</code>) and second (<code>x</code>) dimensions. Then, all pixels in the image were divided by <code>avg_color</code> and multiplied by <code>gray_point</code> through shape-broadcasting.
                </p>
                <table class="comparison">
                    <tr>
                        <th width="150px">Gray point</th>
                        <th>Before</th>
                        <th>After</th>
                    </tr>
                    <tr>
                        <td>(128, 128, 128)</td>
                        <td><img src="results/cathedral.jpg" /></td>
                        <td><img src="extras/white_balance/cathedral_128_128_128.jpg" /></td>
                    </tr>
                    <tr>
                        <td>(180, 180, 180)</td>
                        <td><img src="results/monastery.jpg" /></td>
                        <td><img src="extras/white_balance/monastery_180_180_180.jpg" /></td>
                    </tr>
                    <tr>
                        <td>(150, 150, 150)</td>
                        <td><img src="results/tobolsk.jpg" /></td>
                        <td><img src="extras/white_balance/tobolsk_150_150_150.jpg" /></td>
                    </tr>
                    <tr>
                        <td>(128, 128, 128)</td>
                        <td><img src="results/church.jpg" /></td>
                        <td><img src="extras/white_balance/church_128_128_128.jpg" /></td>
                    </tr>
                    <tr>
                        <td>(128, 128, 128)</td>
                        <td><img src="results/x_bird_cherry_tree.jpg" /></td>
                        <td><img src="extras/white_balance/x_bird_cherry_tree_128_128_128.jpg" />
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <!-- Populate table of contents -->
    <script>
        let first = true
        const toc = document.getElementById('table-of-contents')
        const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6')
        for (let i = 0; i < headings.length; ++i) {
            const node = headings[i]

            // If no id, nothing to link to so skip
            if (!node.id) continue
            
            // Different class for h1, h2, etc
            const tag = node.tagName.toLowerCase()
            let linkClassName = ''
            if (tag === 'h1') {
                // Don't add divider before first item
                if (first) {
                    first = false
                } else {
                    const divider = document.createElement('div')
                    divider.classList.add('divider')
                    toc.appendChild(divider)
                }
                linkClassName = 'title'
            } else if (tag === 'h2') {
                linkClassName = 'section'
            }

            // Add link with correct class/formatting and same text content as
            // its corresponding heading
            const link = document.createElement('a')
            link.classList.add(linkClassName)
            link.href = '#' + node.id
            link.innerHTML = node.innerHTML
            toc.appendChild(link)
        }
    </script>
</body>
</html>
